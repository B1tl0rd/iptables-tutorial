<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>TTL target</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Iptables Tutorial 1.2.2"
HREF="book1.htm"><LINK
REL="UP"
TITLE="Iptables targets and jumps"
HREF="c8815.htm"><LINK
REL="PREVIOUS"
TITLE="TOS target"
HREF="x10464.htm"><LINK
REL="NEXT"
TITLE="ULOG target"
HREF="x10650.htm"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="table.css"></HEAD
><BODY
CLASS="SECTION"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Iptables Tutorial 1.2.2</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x10464.htm"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 11. Iptables targets and jumps</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x10650.htm"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECTION"
><H1
CLASS="SECTION"
><A
NAME="TTLTARGET"
>TTL target</A
></H1
><P
>The TTL target is used to modify the Time 
To Live field in the IP header. One useful application of this is 
to change all Time To Live values to the same value
on all outgoing packets. One reason for doing this is if you have a bully
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>ISP</I
></SPAN
> which don't allow you to have more than one machine
connected to the same Internet connection, and who actively pursues this.
Setting all TTL values to the same value, will effectively
make it a little bit harder for them to notice that you are doing this. We may
then reset the TTL value for all outgoing packets to a
standardized value, such as 64 as specified in the Linux kernel.
    </P
><P
>For more information on how to set the default value used in Linux, read the
<A
HREF="a13413.htm#IP-SYSCTLTXT"
><I
>ip-sysctl.txt</I
></A
>, which you
may find within the <A
HREF="a13413.htm"
><I
>Other resources and links</I
></A
> appendix.
    </P
><P
>The TTL target is only valid within the
mangle table, and nowhere else. It takes 3 options as
of writing this, all of them described below in the table.
    </P
><DIV
CLASS="TABLE"
><A
NAME="TABLE.TTLTARGET"
></A
><P
><B
>Table 11-20. TTL target options</B
></P
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
CLASS="CALSTABLE"
><COL
WIDTH="77"><COL
WIDTH="1*"><TBODY
><TR
><TD
>Option</TD
><TD
>--ttl-set</TD
></TR
><TR
><TD
>Example</TD
><TD
>iptables -t mangle -A PREROUTING -i eth0 -j TTL
--ttl-set 64</TD
></TR
><TR
><TD
>Explanation</TD
><TD
>The --ttl-set option tells the
TTL target which TTL value to set
on the packet in question. A good value would be around 64 somewhere. It's not
too long, and it is not too short. Do not set this value too high, since it
may affect your network and it is a bit immoral to set this value to high,
since the packet may start bouncing back and forth between two mis-configured
routers, and the higher the TTL, the more bandwidth
will be eaten unnecessarily in such a case. This target could be used to limit
how far away our clients are. A good case of this could be
DNS servers, where we don't want the clients to be
too far away.
        </TD
></TR
><TR
><TD
>Option</TD
><TD
>--ttl-dec</TD
></TR
><TR
><TD
>Example</TD
><TD
>iptables -t mangle -A PREROUTING -i eth0 -j TTL
--ttl-dec 1</TD
></TR
><TR
><TD
>Explanation</TD
><TD
>The --ttl-dec option tells the
TTL target to decrement the Time To Live value by the
amount specified after the --ttl-dec option. In other
words, if the TTL for an incoming packet was 53 and
we had set --ttl-dec 3, the packet would leave our host
with a TTL value of 49. The reason for this is that
the networking code will automatically decrement the TTL
value by 1, hence the packet will be decremented by 4 steps,
from 53 to 49. This could for example be used when we want to limit how 
far away the people using our services are. For example, users should 
always use a close-by DNS, and hence we could match
all packets leaving our DNS server and then decrease
it by several steps. Of course, the --set-ttl may be a
better idea for this usage.
       </TD
></TR
><TR
><TD
>Option</TD
><TD
>--ttl-inc</TD
></TR
><TR
><TD
>Example</TD
><TD
>iptables -t mangle -A PREROUTING -i eth0 -j TTL
--ttl-inc 1</TD
></TR
><TR
><TD
>Explanation</TD
><TD
>The --ttl-inc option tells the
TTL target to increment the Time To Live
value with the value specified to the
--ttl-inc
option. This means that we should raise the TTL value
with the value specified in the --ttl-inc option, and if we
specified --ttl-inc 4, a packet entering with a
TTL of 53 would leave the host with
TTL 56. Note that the same thing goes here, as for 
the previous example of the --ttl-dec option, where the 
network code will automatically decrement the TTL 
value by 1, which it always does. This may be used to make our 
firewall a bit more stealthy to trace-routes among other things. By setting 
the TTL one value higher for all incoming packets, we 
effectively make the firewall hidden from trace-routes. Trace-routes are a 
loved and hated thing, since they provide excellent information on problems 
with connections and where it  happens, but at the same time, it gives the 
hacker/cracker some good information about your upstreams if they have 
targeted you. For a good example on how this could be used, see the <A
HREF="x12424.htm"
><I
>Ttl-inc.txt</I
></A
> script.
       </TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Works under Linux kernel 2.3, 2.4, 2.5 and 2.6.
      </P
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x10464.htm"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.htm"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x10650.htm"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>TOS target</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c8815.htm"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>ULOG target</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>