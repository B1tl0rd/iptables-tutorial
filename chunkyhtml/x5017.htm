<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>iptables-save</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Iptables Tutorial 1.2.2"
HREF="book1.htm"><LINK
REL="UP"
TITLE="Saving and restoring large
 rule-sets"
HREF="c4938.htm"><LINK
REL="PREVIOUS"
TITLE="Drawbacks with restore"
HREF="x4987.htm"><LINK
REL="NEXT"
TITLE="iptables-restore"
HREF="x5063.htm"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="table.css"></HEAD
><BODY
CLASS="SECTION"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Iptables Tutorial 1.2.2</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x4987.htm"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 8. Saving and restoring large
 rule-sets</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x5063.htm"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECTION"
><H1
CLASS="SECTION"
><A
NAME="IPTABLES-SAVE"
>iptables-save</A
></H1
><P
>The iptables-save command is, as we have already 
explained, a tool to save the current rule-set into a file that 
iptables-restore can use. This command is quite simple 
really, and takes only two arguments. Take a look at the following 
example to understand the syntax of the command.
   </P
><P
>    <P
>iptables-save [-c] [-t <TT
CLASS="REPLACEABLE"
><I
>table</I
></TT
>]</P
>
   </P
><P
>The -c argument tells iptables-save 
to keep the values specified in the byte and packet counters. This could 
for example be useful if we would like to reboot our main firewall, but 
not lose byte and packet counters which we may use for statistical 
purposes. Issuing a iptables-save command with the 
-c argument would then make it possible for us to 
reboot without breaking our statistical and accounting routines. The 
default value is, of course, to not keep the counters intact when issuing 
this command.
   </P
><P
>The -t argument tells the 
iptables-save command which tables to save. Without
this argument the command will automatically save all tables available 
into the file. The following is an example on what output you can expect 
from the iptables-save command if you do not have any 
rule-set loaded.
   </P
><P
><PRE
CLASS="PROGRAMLISTING"
># Generated by iptables-save v1.2.6a on Wed Apr 24 10:19:17 2002
*filter
:INPUT ACCEPT [404:19766]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [530:43376]
COMMIT
# Completed on Wed Apr 24 10:19:17 2002
# Generated by iptables-save v1.2.6a on Wed Apr 24 10:19:17 2002
*mangle
:PREROUTING ACCEPT [451:22060]
:INPUT ACCEPT [451:22060]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [594:47151]
:POSTROUTING ACCEPT [594:47151]
COMMIT
# Completed on Wed Apr 24 10:19:17 2002
# Generated by iptables-save v1.2.6a on Wed Apr 24 10:19:17 2002
*nat
:PREROUTING ACCEPT [0:0]
:POSTROUTING ACCEPT [3:450]
:OUTPUT ACCEPT [3:450]
COMMIT
# Completed on Wed Apr 24 10:19:17 2002</PRE
></P
><P
>This contains a few comments starting with a # sign. Each table is marked 
like *&lt;table-name&gt;, for example 
*mangle. Then within each table we have 
the chain specifications and rules. A chain specification looks like 
:&lt;chain-name&gt; &lt;chain-policy&gt; 
[&lt;packet-counter&gt;:&lt;byte-counter&gt;]. The  
chain-name may be for example 
PREROUTING, the policy is described previously 
and can, for example, be ACCEPT. Finally the 
packet-counter and byte-counters are the same counters as in the output 
from iptables -L -v. Finally, each table declaration 
ends in a COMMIT keyword. The 
COMMIT keyword tells us that at this 
point we should commit all rules currently in the pipeline to kernel.
   </P
><P
>The above example is pretty basic, and hence I believe it is nothing more
than proper to show a brief example which contains a very small <A
HREF="x12435.htm"
><I
>Iptables-save ruleset</I
></A
>. 
If we would run iptables-save on 
this, it would look something like this in the output:
   </P
><P
><PRE
CLASS="PROGRAMLISTING"
># Generated by iptables-save v1.2.6a on Wed Apr 24 10:19:55 2002
*filter
:INPUT DROP [1:229]
:FORWARD DROP [0:0]
:OUTPUT DROP [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A FORWARD -i eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A FORWARD -i eth1 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT 
-A OUTPUT -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT 
COMMIT
# Completed on Wed Apr 24 10:19:55 2002
# Generated by iptables-save v1.2.6a on Wed Apr 24 10:19:55 2002
*mangle
:PREROUTING ACCEPT [658:32445]
:INPUT ACCEPT [658:32445]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [891:68234]
:POSTROUTING ACCEPT [891:68234]
COMMIT
# Completed on Wed Apr 24 10:19:55 2002
# Generated by iptables-save v1.2.6a on Wed Apr 24 10:19:55 2002
*nat
:PREROUTING ACCEPT [1:229]
:POSTROUTING ACCEPT [3:450]
:OUTPUT ACCEPT [3:450]
-A POSTROUTING -o eth0 -j SNAT --to-source 195.233.192.1 
COMMIT
# Completed on Wed Apr 24 10:19:55 2002</PRE
></P
><P
>As you can see, each command has now been prefixed with the byte and 
packet counters since we used the -c argument. Except 
for this, the command-line is quite intact from the script. The only 
problem now, is how to save the output to a file. Quite simple, and you 
should already know how to do this if you have used linux at all before. 
It is only a matter of piping the command output on to the file that you 
would like to save it as. This could look like the following:
   </P
><P
>    iptables-save -c &#62; /etc/iptables-save
   </P
><P
>The above command will in other words save the whole rule-set to a file 
called <TT
CLASS="FILENAME"
>/etc/iptables-save</TT
> with byte and packet 
counters still intact.
   </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x4987.htm"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.htm"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x5063.htm"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Drawbacks with restore</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c4938.htm"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>iptables-restore</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>