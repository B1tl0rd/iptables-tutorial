<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>SYN/ACK and NEW packets</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Iptables Tutorial 1.2.2"
HREF="book1.htm"><LINK
REL="UP"
TITLE="Common problems and questions"
HREF="a12684.htm"><LINK
REL="PREVIOUS"
TITLE="State NEW packets but no SYN bit set"
HREF="x12721.htm"><LINK
REL="NEXT"
TITLE="Internet Service Providers who use assigned IP addresses"
HREF="x12802.htm"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="table.css"></HEAD
><BODY
CLASS="SECTION"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Iptables Tutorial 1.2.2</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x12721.htm"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Appendix B. Common problems and questions</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x12802.htm"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECTION"
><H1
CLASS="SECTION"
><A
NAME="SYNACKANDNEW"
>SYN/ACK and NEW packets</A
></H1
><P
>Certain TCP spoofing attacks uses a technique called
Sequence Number Prediction. In this type of attack, the attacker spoofs some
other hosts IP address, while  attacking someone, and
tries to predict the Sequence number used by that host. 
   </P
><P
>Let's look on typical TCP spoofing by sequence number
prediction. Players: "attacker" [A], trying to send packets to a "victim" [V],
pretending to be some "other host" [O].
   </P
><P
></P
><OL
TYPE="1"
><LI
><P
>[A] sends SYN to [V] with source IP of [O].</P
></LI
><LI
><P
>[V] replies to [O] by SYN/ACK.</P
></LI
><LI
><P
>now [O] should reply to an unknown SYN/ACK by RST and the
attack is unsuccesful, but let's assume [O] is down (flooded, turned off or
behind firewall that has dropped the packets).</P
></LI
><LI
><P
>if [O] didn't mess it up, [A] now can talk to [V] pretending
to be [O] as long as it predicts correct sequence numbers.</P
></LI
></OL
><P
>As long as we do not send the RST packet to the
unknown SYN/ACK in step 3, we will allow [V] to be
attacked, and ourselves to be incriminated. Common courtesy, would hence be to
send the RST to [V] in a proper way. If we use the
NEW not SYN rules specified
in the ruleset, SYN/ACK packets will be dropped.
Hence, we have the following rules in the
bad_tcp_packets chain, just above the NEW not SYN
rules:
   </P
><PRE
CLASS="SCREEN"
>iptables -A bad_tcp_packets -p tcp --tcp-flags SYN,ACK SYN,ACK \
-m state --state NEW -j REJECT --reject-with tcp-reset
   </PRE
><P
>The chance of being [O] in this scenario should be relatively small, but these 
rules should be safe in almost all cases. Except when you run several redundant 
firewalls which will often take over packets or streams from each other. In such
case, some connections may be blocked, even though they are legit. This rule 
may actually also allow a few portscans to see our firewall as well, but they 
should not be able to tell much more than that.
   </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x12721.htm"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.htm"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x12802.htm"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>State NEW packets but no SYN bit set</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="a12684.htm"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Internet Service Providers who use assigned IP addresses</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>